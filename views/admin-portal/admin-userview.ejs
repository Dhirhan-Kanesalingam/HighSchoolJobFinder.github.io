<!DOCTYPE html>
<html>

<div class="topnav">
  <a class="active" href="/admin-portal/admin-userview">View Users</a>
  <a href="/admin-portal/admin-jobview">View Jobs</a>
  <a href="/admin-portal/admin-myaccount">My Account</a>
</div>

<head>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
</head>

<script>
  // stringify the data passed from router to ejs (within the EJS template only)
  var selectedID = "null"
  var unapprovedUsersJSON = <%- JSON.stringify(unapprovedUsers) %>
</script>

<script>

function verifyUser(userID, number) {
    $.ajax({
      url: '/admin-portal/admin-userview',
      type: 'PUT',
      data: {userID: userID},
      success: function (result) {
        return
      }
    });

    $( "div." + number ).remove();
    $( "#approveButton" ).remove();

  }

    function display(user, number) {

      numberV = number

      selectedID = user._id

      if (user.accountType == "student") {
        $("div.fullUser").html(
          "<br> Full Name:" + user.firstname + user.lastname + "<br>" +
          "Email: " + user.email + "<br>" +
          "Account Type:" + user.accountType + "<br>" +
          "School: " + user.school + "<br>" +
          "Grade: " + user.grade + "<br>" +
          "Date of Birth: " + user.dateOfBirth + "<br>" +
          "isCoop?: " + user.isCoop + "<br>" 
        )
                    var r = $('<input/>').attr({
                         type: "button",
                         id: "approveButton",
                         value: "Approve",
                         onclick: "verifyUser(selectedID, numberV)"
                    });
            $("div.fullUser").append(r);
      } else if (user.accountType == "employer") {
        $("div.fullUser").html(
          "<br> Full Name: " + user.firstname + user.lastname + "<br>" +
          "Email: " + user.email + "<br>" +
          "Account Type: " + user.accountType + "<br>" +
          "School: " + user.school + "<br>" +
          "Company Website: " + user.companyWebsite
        )
                    var r = $('<input/>').attr({
                         type: "button",
                         id: "approveButton",
                         value: "Approve",
                         onclick: "verifyUser(selectedID, numberV)"
                    });
            $("div.fullUser").append(r);
      } else if (user.accountType == "admin") {
        $("div.fullUser").html(
          "<br> Full Name: " + user.firstname + user.lastname + "<br>" +
          "Email: " + user.email + "<br>" +
          "Account Type: " + user.accountType + "<br>" +
          "School: " + user.school + "<br>"
        )
                    var r = $('<input/>').attr({
                         type: "button",
                         id: "approveButton",
                         value: "Approve",
                         onclick: "verifyUser(selectedID, numberV)"
                    });
            $("div.fullUser").append(r);
      }
    }

</script>

<% if (unapprovedUsers != false) { %>}
<div>
  <% var x=0 %>
    <% unapprovedUsers.forEach(p=> { %>
      <br>
      <br>

      <div class="<%=x%>" id="<%=x%>">
      <button onclick="display(unapprovedUsersJSON[<%=x%>], <%=x%>)"> View </button>
      <br>

      <% if (p.accountType=="student" ) { %>
        <div>
          <div>
            <%= p.firstname %>
              <%= p.lastname %>
          </div>

          <div>
            <%= p.accountType %>
          </div>

          <div>
            <%= p.school %>
          </div>
        </div>
        <% } else if (p.accountType=="employer" ) { %>
          <div>
            <div>
              <%= companyName %>
            </div>

            <div>
              <%= p.accountType %>
            </div>

            <div>
              <%= p.city %>
            </div>
          </div>
          <% } else if (p.accountType=="admin" ) { %>
            <div>
              <div>
                <%= p.firstname %>
                  <%= p.lastname %>
              </div>

              <div>
                <%= p.accountType %>
              </div>

              <div>
                <%= p.school %>
              </div>
            </div>
            <% } %>
          </div>
              <% x++ }) %>

</div>
<% } %>

<div class="fullUser" id="fullUser">

</div>

<script>
  // stringify the data passed from router to ejs (within the EJS template only)
  var usersSearched = <%- JSON.stringify(result) %>
</script>

<form action="/searchUser" method="GET">

  <select name="userType" id="userType">
    <option value="student" <% if((userType).includes("student")){ %> selected <% } %>>Student</option>
    <option value="employer" <% if((userType).includes("employer")){ %> selected <% } %>>Employer</option>
    <option value="admin" <% if((userType).includes("admin")){ %> selected <% } %>>Admin</option>
</select>

  <select name="school" id="school">
    <option value="Earl of March Secondary School">Earl of March Secondary School</option>
  </select>

  <input type="text" id="term" name="term" value="<%=term%>">
  <button>Search</button>
</form>

<div>
  <% var x=0 %>
    <% if (result) { %>
      <% result.forEach(p=> { %>
        <br>
        <button onclick="display(usersSearched[<%=x%>])"> View </button>
        <div>

          <div>
           <%= p.firstname %> <%= p.lastname %>
          </div>

          <div>
   
          </div>
        </div>
        </form>
        <% x++ }) %>
          <% } %>
</div>

<script>
    function display(jobpost) {
      console.log(jobpost)
      $("div.fullPost").html("<br> Title:" + jobpost.jobTitle + "<br>" +
      "Location:" + jobpost.location + "<br>" +
        "Type:" + jobpost.type + "<br>" +
        "Discipline:" + jobpost.discipline + "<br>" +
        "briefDescription:" + jobpost.briefDescription + "<br>" +
        "Description:" + jobpost.description + "<br>" +
        "Responsibilities:" + jobpost.responsibilities + "<br>" +
        "Skills:" + jobpost.skills + "<br>" +
        "Posted on:" + jobpost.createdAt + "<br>" +
        '<form action="/student-portal/student-applications" method="GET">' +
        '<input type="hidden" id="postID" name="postID" value=' + jobpost._id + '>' +
        '<button>Apply</button>'
      )
    }
</script>

<div class="fullPost">

</div>



<li><a href="/logout">Logout</a></li>

</html>